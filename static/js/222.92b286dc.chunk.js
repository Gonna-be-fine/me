"use strict";(self.webpackChunktiny_me=self.webpackChunktiny_me||[]).push([[222],{9222:function(t,e,i){var n=i(5671),s=i(3144),o=i(9062),u=i(2860),h=i(7760),l=i(7133),p=i(7326),c=i(136),f=i(9388);function v(t,e){var r=new h.Matrix4,i=new h.Ray,a=new h.Sphere,n=new h.Vector3,s=this.geometry;if(a.copy(s.boundingSphere),a.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(a,n)){r.getInverse(this.matrixWorld),i.copy(t.ray).applyMatrix4(r);var o=new h.Vector3,u=new h.Vector3,l=new h.Vector3,p=this instanceof h.LineSegments?2:1,c=s.index,f=s.attributes;if(null!==c)for(var v=c.array,y=f.position.array,g=f.width.array,d=0,m=v.length-1;d<m;d+=p){var x=v[d],w=v[d+1];o.fromArray(y,3*x),u.fromArray(y,3*w);var b=void 0!==g[Math.floor(d/3)]?g[Math.floor(d/3)]:1,A=t.params.Line.threshold+this.material.lineWidth*b/2,M=A*A;if(!(i.distanceSqToSegment(o,u,n,l)>M)){n.applyMatrix4(this.matrixWorld);var _=t.ray.origin.distanceTo(n);_<t.near||_>t.far||(e.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this}),d=m)}}}}function y(t,e,r,i,a){var n;if(t=t.subarray||t.slice?t:t.buffer,r=r.subarray||r.slice?r:r.buffer,t=e?t.subarray?t.subarray(e,a&&e+a):t.slice(e,a&&e+a):t,r.set)r.set(t,i);else for(n=0;n<t.length;n+=1)r[n+i]=t[n];return r}var g=function(t){(0,c.Z)(r,t);var e=(0,f.Z)(r);function r(){var t;return(0,n.Z)(this,r),(t=e.call(this)).type="MeshLine",t.isMeshLine=!0,t.positions=[],t.raycast=v,t.previous=[],t.next=[],t.side=[],t.width=[],t.indices_array=[],t.uvs=[],t.counters=[],t._points=[],t._geom=null,t.widthCallback=null,t.matrixWorld=new h.Matrix4,Object.defineProperties((0,p.Z)(t),{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(t){this.setPoints(t,this.widthCallback)}}}),t}return(0,s.Z)(r,[{key:"setMatrixWorld",value:function(t){this.matrixWorld=t}},{key:"setGeometry",value:function(t,e){this._geometry=t,t instanceof h.BufferGeometry?this.setPoints(t.getAttribute("position").array,e):this.setPoints(t,e)}},{key:"setPoints",value:function(t,e){if(this._points=t,this.widthCallback=e,this.positions=[],this.counters=[],t.length&&t[0]instanceof h.Vector3)for(var r=0;r<t.length;r+=1){var i=t[r],a=r/t.length;this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(a),this.counters.push(a)}else for(var n=0;n<t.length;n+=3){var s=n/t.length;this.positions.push(t[n],t[n+1],t[n+2]),this.positions.push(t[n],t[n+1],t[n+2]),this.counters.push(s),this.counters.push(s)}this.process()}},{key:"compareV3",value:function(t,e){var r=6*t,i=6*e;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]}},{key:"copyV3",value:function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]}},{key:"process",value:function(){var t,e,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],e=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(var i=0;i<r;i+=1){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1),i<r-1){e=this.copyV3(i),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);var a=2*i;this.indices_array.push(a,a+1,a+2),this.indices_array.push(a+2,a+1,a+3)}i>0&&(e=this.copyV3(i),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]))}e=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new h.BufferAttribute(new Float32Array(this.positions),3),previous:new h.BufferAttribute(new Float32Array(this.previous),3),next:new h.BufferAttribute(new Float32Array(this.next),3),side:new h.BufferAttribute(new Float32Array(this.side),1),width:new h.BufferAttribute(new Float32Array(this.width),1),uv:new h.BufferAttribute(new Float32Array(this.uvs),2),index:new h.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new h.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}},{key:"advance",value:function(t){var e=t.x,r=t.y,i=t.z,a=this._attributes.position.array,n=this._attributes.previous.array,s=this._attributes.next.array,o=a.length;y.memcpy(a,0,n,0,o),y.memcpy(a,6,a,0,o-6),a[o-6]=e,a[o-5]=r,a[o-4]=i,a[o-3]=e,a[o-2]=r,a[o-1]=i,y.memcpy(a,6,s,0,o-6),s[o-6]=e,s[o-5]=r,s[o-4]=i,s[o-3]=e,s[o-2]=r,s[o-1]=i,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}]),r}(h.BufferGeometry),d=i(1413),m=i(8301),x=i(1120);h.ShaderChunk.meshline_vert=["","#include <common>","",h.ShaderChunk.logdepthbuf_pars_vertex,h.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform vec2 offset;","uniform float speed;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv+offset;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",h.ShaderChunk.logdepthbuf_vertex,h.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",h.ShaderChunk.fog_vertex,"}"].join("\n"),h.ShaderChunk.meshline_frag=["",h.ShaderChunk.fog_pars_fragment,h.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",h.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",h.ShaderChunk.fog_fragment,"}"].join("\n");h.ShaderMaterial;var w=i(5322);i(4235);var b=6378137;function A(t){return[(180+t[0])%360/360*(2*Math.PI*b),(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360*(2*Math.PI*b)]}function M(t,e){return{x:e[0]-t[0],y:t[1]-e[1]}}var _=new(function(){function t(){(0,n.Z)(this,t)}return(0,s.Z)(t,[{key:"generateBuilding",value:function(t){var e=t.path,i=t.type,n=(t.center,t.storeyHeight),s=t.gisCenterPos,o=[];switch(i){case"earth":console.log(r);break;case"gis":for(var u=0;u<e.length;u++){var p=e[u].map((function(t){var e=A([t.x,t.y]),r=M(s,e);return new h.Vector3(r.x,r.y,t.z*n)}));o.push(p)}break;case"normal":for(var c=0;c<e.length;c++){p=e[c].map((function(t){var e=M(s,[t.x,t.y]);return new h.Vector3(e.x,e.y,t.z*n)}));o.push(p)}break;default:console.log("wrong viewer type: ".concat(a))}var f=[],v=[],y=[];for(c=0;c<o.length;c++){for(var g=o[c],d=[],m=0;m<g.length;m++)d.push(g[m].x,g[m].y);for(var x=[],w=d,b=0,_=0;b<w.length-2;b+=2,_+=1)0===b?x[0]=Math.sqrt((w[2]-w[0])*(w[2]-w[0])+(w[3]-w[1])*(w[3]-w[1])):x[_]=x[_-1]+Math.sqrt((w[b+2]-w[b])*(w[b+2]-w[b])+(w[b+3]-w[b+1])*(w[b+3]-w[b+1]));for(var P=[],z=[],V=[],k=x[x.length-1],B=0,C=P.length,S=20*n,F=z.length,I=V.length;B<g.length;B+=1){var U=g[B],W=B===g.length-1?g[0]:g[B+1],G=x[B];P[C++]=U.x,P[C++]=U.y,P[C++]=0,z[F++]=0===B?0:x[B-1]/k,z[F++]=0,V[I++]=g.length-1,V[I++]=U.z/S,P[C++]=U.x,P[C++]=U.y,P[C++]=U.z,z[F++]=0===B?0:x[B-1]/k,z[F++]=U.z/S,V[I++]=g.length-1,V[I++]=U.z/S,P[C++]=W.x,P[C++]=W.y,P[C++]=W.z,z[F++]=G/k,z[F++]=W.z/S,V[I++]=g.length-1,V[I++]=W.z/S,P[C++]=W.x,P[C++]=W.y,P[C++]=0,z[F++]=G/k,z[F++]=0,V[I++]=g.length-1,V[I++]=U.z/S,P[C++]=U.x,P[C++]=U.y,P[C++]=0,z[F++]=0===B?0:x[B-1]/k,z[F++]=0,V[I++]=o.length-1,V[I++]=U.z/S,P[C++]=W.x,P[C++]=W.y,P[C++]=W.z,z[F++]=G/k,z[F++]=W.z/S,V[I++]=g.length-1,V[I++]=W.z/S}f.push(P),v.push(z),y.push(V)}for(var L=[],Z=0;Z<o.length;Z++){var j=o[Z],E=new h.Mesh(new h.ShapeGeometry(new h.Shape(j)),new h.MeshBasicMaterial({color:16777215}));E.position.z=j[0].z,E.updateMatrixWorld(),E.geometry.applyMatrix4(E.matrixWorld),E.updateMatrix(),L.push(E)}var R=l.n4(L.map((function(t){return t.geometry}))),T=R.getAttribute("uv").array,D=R.getAttribute("position").array,q=R.getIndex().array;L.forEach((function(t){t.geometry.dispose(),t.material.dispose()})),L=[];for(var H=0;H<f.length;H++){var N=new h.BufferGeometry;N.setAttribute("position",new h.BufferAttribute(new Float32Array(f[H]),3)),N.setAttribute("uv",new h.BufferAttribute(new Float32Array(v[H]),2)),N.setAttribute("uv2",new h.BufferAttribute(new Float32Array(y[H]),2));var O=new h.Mesh(N,new h.MeshBasicMaterial({color:16777215}));O.updateMatrix(),L.push(O)}var Q=l.n4(L.map((function(t){return t.geometry})));Q.computeVertexNormals();var J=Q.getAttribute("normal").array,K=Q.getAttribute("position").array,X=Q.getAttribute("uv").array,Y=Q.getAttribute("uv2").array;return L.forEach((function(t){t.geometry.dispose(),t.material.dispose()})),L=null,{sideNormal:J,sidePosition:K,sideUV:X,sideUV2:Y,topUV:T,topPosition:D,topIndex:q}}},{key:"generateAttributes",value:function(t){var e=h.Vector3,r=h.BufferGeometry,i=h.Mesh,a=h.MeshBasicMaterial,n=h.ShapeGeometry,s=h.Shape,o=h.BufferAttribute,u=h.BufferGeometry,p=6378137;function c(t,e){return{x:e[0]-t[0],y:t[1]-e[1]}}function f(t){for(;t.some((function(t){return Array.isArray(t)}));)t=[].concat.apply([],t);return t}var v=t,y=v.path,g=v.type,d=v.center,m=v.storeyHeight,x=v.gisCenterPos,w=[];switch(g){case"earth":console.log(y);break;case"gis":for(var b=0;b<y.length;b++){var A;A=y[b].map((function(t){var r,i=[(180+(r=[t.x,t.y])[0])%360/360*(2*Math.PI*p),(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360*(2*Math.PI*p)],a=c(x,i);return new e(a.x,a.y,t.z*m)})),w.push(A)}break;case"normal":for(var M=0;M<y.length;M++){var _;_=y[M].map((function(t){var r=c(d,[t.x,t.y]);return new e(r.x,r.y,t.z*m)})),w.push(_)}break;default:console.log("wrong viewer type: ".concat(g))}for(var P=[],z=[],V=[],k=0;k<w.length;k++){for(var B=w[k],C=[],S=0;S<B.length;S++){var F=B[S];C.push([F.x,F.y])}for(var I=f(C),U=[],W=0,G=0;W<I.length-2;W+=2,G++)0===W?U[0]=Math.sqrt((I[2]-I[0])*(I[2]-I[0])+(I[3]-I[1])*(I[3]-I[1])):U[G]=U[G-1]+Math.sqrt((I[W+2]-I[W])*(I[W+2]-I[W])+(I[W+3]-I[W+1])*(I[W+3]-I[W+1]));for(var L=[],Z=[],j=[],E=U[U.length-1],R=20*m,T=0,D=L.length,q=Z.length,H=j.length;T<B.length;T++){var N=B[T],O=B[T+1];T===B.length-1&&(O=B[0]);var Q=U[T];L[D++]=N.x,L[D++]=N.y,L[D++]=0,Z[q++]=0===T?0:U[T-1]/E,Z[q++]=0,j[H++]=B.length-1,j[H++]=N.z/R,L[D++]=N.x,L[D++]=N.y,L[D++]=N.z,Z[q++]=0===T?0:U[T-1]/E,Z[q++]=N.z/R,j[H++]=B.length-1,j[H++]=N.z/R,L[D++]=O.x,L[D++]=O.y,L[D++]=O.z,Z[q++]=Q/E,Z[q++]=O.z/R,j[H++]=B.length-1,j[H++]=O.z/R,L[D++]=O.x,L[D++]=O.y,L[D++]=0,Z[q++]=Q/E,Z[q++]=0,j[H++]=B.length-1,j[H++]=N.z/R,L[D++]=N.x,L[D++]=N.y,L[D++]=0,Z[q++]=0===T?0:U[T-1]/E,Z[q++]=0,j[H++]=B.length-1,j[H++]=N.z/R,L[D++]=O.x,L[D++]=O.y,L[D++]=O.z,Z[q++]=Q/E,Z[q++]=O.z/R,j[H++]=B.length-1,j[H++]=O.z/R}P.push(L),z.push(Z),V.push(j)}for(var J=[],K=new r,X=0;X<w.length;X++){var Y=w[X],$=new i(new n(new s(Y)),new h.MeshBasicMaterial({color:16777215}));$.position.z=Y[0].z,$.updateMatrixWorld(),$.geometry.applyMatrix4($.matrixWorld),$.updateMatrix(),J.push($)}K=l.n4(J.map((function(t){return t.geometry}))),J.forEach((function(t){t.geometry.dispose(),t.material.dispose()})),J=[];for(var tt=K,et=tt.attributes.position.array,rt=tt.attributes.uv.array,it=tt.index.array,at=null,nt=0;nt<P.length;nt++){var st=new u;st.setAttribute("position",new o(new Float32Array(P[nt]),3)),st.setAttribute("uv",new o(new Float32Array(z[nt]),2)),st.setAttribute("uv2",new o(new Float32Array(V[nt]),2));var ot=new i(st,new a({color:16777215}));ot.updateMatrix(),J.push(ot)}at=l.n4(J.map((function(t){return t.geometry}))),J.forEach((function(t){t.geometry.dispose(),t.material.dispose()})),at.computeVertexNormals();var ut=at,ht=ut.attributes.position.array,lt=ut.attributes.uv.array;return{positions:ht,uvs2:ut.attributes.uv2.array,uvs:lt,topPositions:et,topUvs:rt,topIndex:it,normals:ut.attributes.normal.array}}},{key:"generateWaterAttr",value:function(t){for(var e=function(t,e,r,i){var a=[];switch(r){case"earth":break;case"gis":for(var n=0;n<i.length;n++){var s=i[n];if(Array.isArray(s[0])){for(var o=[],u=0;u<s.length;u++)o.push(s[u].map((function(t){var r=A([t.x,t.y]),i=M(e,r);return new h.Vector3(i.x,i.y,t.z)})));a.push(o)}else a.push(s.map((function(t){var r=A([t.x,t.y]),i=M(e,r);return new h.Vector3(i.x,i.y,t.z)})))}break;case"normal":for(var l=0;l<i.length;l++){var p=i[l];if(Array.isArray(p[0])){for(var c=[],f=0;f<p.length;f++)c.push(p[f].map((function(e){var r=M(t,[e.x,e.y]);return new h.Vector3(r.x,r.y,e.z)})));a.push(c)}else a.push(p.map((function(e){var r=M(t,[e.x,e.y]);return new h.Vector3(r.x,r.y,e.z)})))}break;default:console.warn("no such type in engine".concat(r))}return a}(t.center,t.gisCenterPos,t.type,function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r].geometry&&t[r].geometry.type;if("MultiPolygon"===i)for(var a=t[r].geometry.coordinates,n=0;n<a.length;n++){var s=a[n];if(1===s.length){for(var o=s[0],u=[],l=0,p=o.length;l<p;l++)u.push(new h.Vector3(o[l][0],o[l][1],0));e.push(u)}else{for(var c=[],f=0,v=s.length;f<v;f++){for(var y=[],g=s[f],d=0,m=g.length;d<m;d++)y.push(new h.Vector3(g[d][0],g[d][1],0));c.push(y)}e.push(c)}}else if("Polygon"===i){var x=t[r].geometry.coordinates;if(1===x.length){for(var w=x[0],b=[],A=0;A<w.length;A++)b.push(new h.Vector3(w[A][0],w[A][1],0));e.push(b)}else{for(var M=[],_=0;_<x.length;_++){for(var P=[],z=x[_],V=0;V<z.length;V++)P.push(new h.Vector3(z[V][0],z[V][1],0));M.push(P)}e.push(M)}}else if(!i)for(var k=t[r],B=0;B<k.length;B++){for(var C=[],S=k[B],F=0;F<S.length;F++)C.push(S[F]);e.push(C)}}return e}(t.path)),r=[],i=null,a=0;a<e.length;a++)if(Array.isArray(e[a][0])){for(var n=null,s=0;s<e[a].length;s++)0===s?n=new h.Shape(e[a][s]):n.holes.push(new h.Path(e[a][s]));var o=new h.Mesh(new h.ShapeGeometry(n),new h.MeshBasicMaterial);o.updateMatrix(),r.push(o)}else{var u=new h.Mesh(new h.ShapeGeometry(new h.Shape(e[a])),new h.MeshBasicMaterial);u.updateMatrix(),r.push(u)}i=l.n4(r.map((function(t){return t.geometry}))),r.forEach((function(t){t.geometry.dispose(),t.material.dispose(),t=null})),i.computeBoundingBox(),function(t){var e=new h.Vector3,r=new h.Vector3;t.computeBoundingBox(),e.copy(t.boundingBox.min),r.copy(t.boundingBox.max);var i=new h.Vector3;i.subVectors(r,e);for(var a=[],n=t.attributes.position.array,s=0;s<n.length;s+=3){var o=(new h.Vector3).fromArray([n[s],n[s+1],n[s+2]]).sub(e).divide(i),u=o.x,l=o.y;a.push(u,l)}t.setAttribute("uv",new h.BufferAttribute(new Float32Array(a),2))}(i);var p=i.index,c=i.getAttribute("position").array,f=p.array,v=i.getAttribute("uv").array,y=i.getAttribute("normal").array;return i.dispose(),{positions:c,uvs:v,index:f,normal:y}}},{key:"generateTerrain",value:function(t){var e=t.points,r=t.type,i=t.center,a=t.gisCenterPos,n=[],s=1/0,o=-1/0;e.forEach((function(t){var e=[],r=0;Array.isArray(t)?(e=[t[0],t[1]],r=t[2]):(e=t.lngLat||t.xy||t._lngLat||t._xy,r=t.height||t.z||t.h),void 0!==r&&e&&(s=Math.min(s,r),o=Math.max(o,r),n.push({geometry:{coordinates:e,type:"Point"},properties:{z:r}}))}));for(var u={},l=[],p=[],c=0,f=n.length;c<f;c++){var v=n[c],y=v.geometry,g=v.properties,d=y.coordinates;u[d.toString()]=c;var m=g.z,x=null;switch(r){case"earth":console.log(v);break;case"gis":x=M(a,[(180+d[0])%360/360*(2*Math.PI*b),(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360*(2*Math.PI*b)]);break;case"normal":x=M(i,v);break;default:console.warn("no such viewer type in engine: ".concat(r))}l.push(x.x,x.y,m),p.push(m)}var A={result:{type:"FeatureCollection",features:[]},faces:[]};if(n&&Array.isArray(n)){var _=w.uf4(e.map((function(t){return w.xmu(t)})));A.result=w.wRQ(_),console.log(A.result)}var P=A.result.features,z=[];if(P.length>0)for(var V=0,k=P.length;V<k;V++)for(var B=P[V].geometry.coordinates[0],C=0,S=B.length;C<S-1;C++){var F=u[B[C].slice(0,2).toString()];z.push(F)}var I=[],U=0;for(S=z.length;U<S;U+=3){var W=z[U],G=z[U+1];C=z[U+2];(p[W]>s||p[G]>s||p[C]>s)&&I.push(W,G,C)}var L=new h.BufferGeometry;return L.setAttribute("position",new h.BufferAttribute(new Float32Array(l),3)),L.setIndex(new h.BufferAttribute(new Uint32Array(I),1)),L.computeVertexNormals(),{positions:L.attributes.position.array,normal:L.attributes.normal.array,index:L.getIndex().array,maxHeight:o,minHeight:s}}},{key:"generateRoadAttr",value:function(t){var e=t.center,r=t.gisCenterPos,i=t.type,a=t.path,n=w.beQ(a),s=A(n.geometry.coordinates);n=M(r,s),console.log(n);var p=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r].geometry&&t[r].geometry.type;if("MultiLineString"===i)for(var a=t[r].geometry.coordinates,n=0;n<a.length;n++){var s=a[n];if(1===s.length){for(var o=s[0],l=[],p=o.length;0<p;(0,u.Z)("j"))l.push(new h.Vector3(o[0][0],o[0][1],0));e.push(l)}else{for(var c=[],f=0,v=s.length;f<v;f++){var y=s[f];c.push(new h.Vector3(y[0],y[1],0))}e.push(c)}}else if("LineString"===i){var g=t[r].geometry.coordinates;if(1===g.length){for(var d=g[0],m=[],x=0;x<d.length;x++)m.push(new h.Vector3(d[x][0],d[x][1],0));e.push(m)}else{for(var w=[],b=0;b<g.length;b++){var A=g[b];w.push(new h.Vector3(A[0],A[1],0))}e.push(w)}}else if(!i)for(var M=t[r],_=0;_<M.length;_++){for(var P=[],z=M[_],V=0;V<z.length;V++)P.push(z[V]);e.push(P)}}return e}(a.features),c=function(t,e,r,i){var a=[];switch(r){case"earth":break;case"gis":for(var n=0;n<i.length;n++){var s=i[n],u=[];if(Array.isArray(s[0])){for(var l=0;l<s.length;l++)u.push(s[l].map((function(t){var r=A([t.x,t.y]),i=M(e,r);return new h.Vector3(i.x,i.y,t.z)})));a.push(u)}else u.push.apply(u,(0,o.Z)(s.map((function(t){var r=A([t.x,t.y]),i=M(e,r);return new h.Vector3(i.x,i.y,t.z)})))),a.push(u)}break;case"normal":for(var p=0;p<i.length;p++){var c=i[p],f=[];if(Array.isArray(c[0])){for(var v=0;v<c.length;v++)f.push(c[v].map((function(e){var r=M(t,[e.x,e.y]);return new h.Vector3(r.x,r.y,e.z)})));a.push(f)}else f.push(c.map((function(e){var r=M(t,[e.x,e.y]);return new h.Vector3(r.x,r.y,e.z)}))),a.push(f)}break;default:console.warn("no such type in engine".concat(r))}return a}(e,r,i,p);c=c.map((function(t){return t.map((function(t){return t.sub(n)}))}));var f=c.map((function(t){return function(t){var e=new h.BufferGeometry;e.setFromPoints(t);var r=new g;return r.setGeometry(e),r}(t)})),v=l.n4(f.map((function(t){return t})));return f.forEach((function(t){t.dispose(),t=null})),f=null,{counters:v.getAttribute("counters").array,next:v.getAttribute("next").array,position:v.getAttribute("position").array,previous:v.getAttribute("previous").array,side:v.getAttribute("side").array,uv:v.getAttribute("uv").array,index:v.getIndex().array,width:v.getAttribute("width").array,center:n}}}]),t}());self.addEventListener("message",(function(t){var e=t.data,r=e.type,i=e.data,a={generateBuilding:function(t){return _.generateBuilding(t)},generateWater:function(t){return _.generateWaterAttr(t)},generateTerrain:function(t){return _.generateTerrain(t)},generateRoadAttr:function(t){return _.generateRoadAttr(t)}},n=a[r]&&a[r](i);postMessage(n),close()}))}}]);
//# sourceMappingURL=222.92b286dc.chunk.js.map